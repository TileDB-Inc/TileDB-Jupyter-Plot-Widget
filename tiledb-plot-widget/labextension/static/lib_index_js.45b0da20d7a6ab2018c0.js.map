{"version":3,"file":"lib_index_js.45b0da20d7a6ab2018c0.js","mappings":";;;;;;;;;AAAa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,kBAAe;;;;;;;;;;;ACXF;AACb;AACA;AACA,mCAAmC,oCAAoC,gBAAgB;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,eAAe,mBAAO,CAAC,0GAAuB;AAC9C,aAAa,mBAAO,CAAC,mCAAW;AAChC,mCAAmC,mBAAO,CAAC,iCAAU;AACrD,kBAAkB,mBAAO,CAAC,mCAAW;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,kBAAe;;;;;;;;;;;AC3CF;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;;;;;;;;;;;ACtBC;AACb;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,mBAAmB,GAAG,sBAAsB;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA;AACA;AACA,mBAAmB;;;;;;;;;;;ACjBN;AACb;AACA;AACA;AACA;AACA,mCAAmC,oCAAoC,gBAAgB;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,0CAA0C,4BAA4B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,wBAAwB,GAAG,yBAAyB;AACpD,eAAe,mBAAO,CAAC,0GAAuB;AAC9C,wBAAwB,mBAAO,CAAC,iDAAI;AACpC,mCAAmC,mBAAO,CAAC,qCAAY;AACvD,oCAAoC,mBAAO,CAAC,4FAA8B;AAC1E,kBAAkB,mBAAO,CAAC,mCAAW;AACrC,eAAe,mBAAO,CAAC,6BAAQ;AAC/B;AACA;AACA;AACA,6CAA6C,uBAAuB,uTAAuT;AAC3X;AACA;AACA,yBAAyB;AACzB,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA,kDAAkD;AAClD,uDAAuD;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,wCAAwC;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,eAAe;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,WAAW,GAAG,YAAY,IAAI,WAAW,GAAG,+BAA+B,EAAE,WAAW,GAAG,+BAA+B,EAAE,WAAW,GAAG,WAAW;AAChL,aAAa;AACb,8CAA8C,gBAAgB;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,UAAU,EAAE,yCAAyC;AAC9F;AACA;AACA;AACA,gCAAgC,KAAK,IAAI,SAAS;AAClD,sCAAsC,sBAAsB;AAC5D,qCAAqC,sBAAsB;AAC3D,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;;;;;;;;;;;;;;;ACnRxB,iEAAe,qBAAuB,wEAAwE","sources":["webpack://@tiledb-inc/tiledb-plot-widget/./lib/debounce.js","webpack://@tiledb-inc/tiledb-plot-widget/./lib/index.js","webpack://@tiledb-inc/tiledb-plot-widget/./lib/poll.js","webpack://@tiledb-inc/tiledb-plot-widget/./lib/version.js","webpack://@tiledb-inc/tiledb-plot-widget/./lib/widget.js","webpack://@tiledb-inc/tiledb-plot-widget/./lib/worker.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst debounce = (func, waitFor) => {\n    let timeout;\n    return (...args) => new Promise(resolve => {\n        if (timeout) {\n            clearTimeout(timeout);\n        }\n        timeout = setTimeout(() => resolve(func(...args)), waitFor);\n    });\n};\nexports.default = debounce;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst base_1 = require(\"@jupyter-widgets/base\");\n__exportStar(require(\"./version\"), exports);\nconst widgetExports = __importStar(require(\"./widget\"));\nconst version_1 = require(\"./version\");\n/**\n * Initialization data for the @tiledb-inc/tiledb-plot-widget extension.\n */\nconst plugin = {\n    id: '@tiledb-inc/tiledb-plot-widget:plugin',\n    requires: [base_1.IJupyterWidgetRegistry],\n    autoStart: true,\n    activate: (app, registry) => {\n        registry.registerWidget({\n            name: version_1.MODULE_NAME,\n            version: version_1.MODULE_VERSION,\n            exports: widgetExports\n        });\n    }\n};\nexports.default = plugin;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.poll = void 0;\nfunction poll(fn, timeout = 2000, interval = 100) {\n    const endTime = Number(new Date()) + timeout;\n    const checkCondition = function (resolve, reject) {\n        // If the condition is met, we're done!\n        const result = fn();\n        if (result) {\n            resolve(result);\n        }\n        // If the condition isn't met but the timeout hasn't elapsed, go again\n        else if (Number(new Date()) < endTime) {\n            setTimeout(checkCondition, interval, resolve, reject);\n        }\n        // Didn't match and too much time, reject!\n        else {\n            reject(new Error('timed out for ' + fn + ': '));\n        }\n    };\n    return new Promise(checkCondition);\n}\nexports.poll = poll;\n","\"use strict\";\n// Copyright (c) TileDB\n// Distributed under the terms of the MIT License.\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MODULE_NAME = exports.MODULE_VERSION = void 0;\n// eslint-disable-next-line @typescript-eslint/no-var-requires\n// const data = require('../package.json');\n/**\n * The _model_module_version/_view_module_version this package implements.\n *\n * The html widget manager assumes that this is the same as the npm package\n * version number.\n */\nexports.MODULE_VERSION = '0.2.0';\n/*\n * The current package name.\n */\nexports.MODULE_NAME = '@tiledb-inc/tiledb-plot-widget';\n","\"use strict\";\n// Copyright (c) TileDB\n// Distributed under the terms of the MIT License.\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DagVisualizeView = exports.DagVisualizeModel = void 0;\nconst base_1 = require(\"@jupyter-widgets/base\");\nconst d3 = __importStar(require(\"d3\"));\nconst debounce_1 = __importDefault(require(\"./debounce\"));\nconst worker_js_1 = __importDefault(require(\"file-loader!../lib/worker.js\"));\nconst version_1 = require(\"./version\");\nconst poll_1 = require(\"./poll\");\n// const BOX_ASPECT_RATIO = 0.36;\nclass DagVisualizeModel extends base_1.DOMWidgetModel {\n    defaults() {\n        return Object.assign(Object.assign({}, super.defaults()), { _model_name: DagVisualizeModel.model_name, _model_module: DagVisualizeModel.model_module, _model_module_version: DagVisualizeModel.model_module_version, _view_name: DagVisualizeModel.view_name, _view_module: DagVisualizeModel.view_module, _view_module_version: DagVisualizeModel.view_module_version, value: '' });\n    }\n}\nexports.DagVisualizeModel = DagVisualizeModel;\nDagVisualizeModel.serializers = Object.assign({}, base_1.DOMWidgetModel.serializers\n// Add any extra serializers here\n);\nDagVisualizeModel.model_name = 'DagVisualizeModel';\nDagVisualizeModel.model_module = version_1.MODULE_NAME;\nDagVisualizeModel.model_module_version = version_1.MODULE_VERSION;\nDagVisualizeModel.view_name = 'DagVisualizeView'; // Set to null if no view\nDagVisualizeModel.view_module = version_1.MODULE_NAME; // Set to null if no view\nDagVisualizeModel.view_module_version = version_1.MODULE_VERSION;\nconst PADDING = 40;\nclass DagVisualizeView extends base_1.DOMWidgetView {\n    render() {\n        this.el.classList.add('tiledb-widget');\n        this.createSVG();\n        this.value_changed();\n        /**\n         * Debounce rendering function so it won't rerender too fast\n         */\n        const debouncedOnChange = debounce_1.default(this.value_changed.bind(this), 1500);\n        this.model.on('change:value', debouncedOnChange, this);\n    }\n    value_changed() {\n        this.data = JSON.parse(this.model.get('value'));\n        /**\n         * Reset html and build new graph\n         */\n        this.createDag();\n    }\n    calculateBounds(positions) {\n        if (typeof this.bounds === 'undefined') {\n            const xNums = Object.keys(positions).map((pos) => positions[pos][0]);\n            const yNums = Object.keys(positions).map((pos) => positions[pos][1]);\n            const padding = 30;\n            const verticalPadding = 60;\n            const maxHorizontalCoordinate = Math.max(...xNums);\n            const maxVerticalCoordinate = Math.max(...yNums);\n            this.bounds = [\n                maxHorizontalCoordinate + padding,\n                maxVerticalCoordinate + verticalPadding\n            ];\n        }\n        return this.bounds;\n    }\n    createSVG() {\n        this.wrapper = d3.select(this.el).append('svg').append('g');\n        this.svg = d3.select(this.el).select('svg');\n        this.createControls();\n        this.createTooltip();\n    }\n    getScale() {\n        const [maxWidth, height] = this.bounds;\n        const scaleX = this.el.offsetWidth / (maxWidth + PADDING);\n        const scaleY = 400 / (height + PADDING);\n        return [scaleX, scaleY];\n    }\n    zoom() {\n        const [width, height] = this.bounds;\n        const [scaleX, scaleY] = this.getScale();\n        const svg = this.svg;\n        const zoom = d3\n            .zoom()\n            .translateExtent([\n            [0, 0],\n            [width * scaleX + PADDING, height * scaleY + PADDING]\n        ])\n            .on('zoom', () => {\n            this.wrapper.attr('transform', d3.event.transform);\n        });\n        svg.call(zoom).on('wheel.zoom', null);\n        function zoomHandler() {\n            d3.event.preventDefault();\n            const direction = this.id === 'zoom_in' ? 0.2 : -0.2;\n            /**\n             * In SVG 1.1 <svg> elements did not support transform attributes. In SVG 2 it is proposed that they should.\n             * Chrome and Firefox implement this part of the SVG 2 specification, Safari does not yet do so and IE11 never will.\n             * That's why we apply transform to the \"g\" element instead of the \"svg\"\n             */\n            svg\n                .transition()\n                .duration(300)\n                .call(zoom.scaleBy, 1 + direction);\n        }\n        function resetHandler() {\n            svg.transition().duration(300).call(zoom.transform, d3.zoomIdentity);\n        }\n        setTimeout(() => {\n            d3.select(this.el).selectAll('.zoomControl').on('click', zoomHandler);\n            d3.select(this.el).selectAll('.resetControl').on('click', resetHandler);\n        }, 0);\n        this.initialized = true;\n    }\n    createTooltip() {\n        this.tooltip = d3\n            .select(this.el)\n            .append('div')\n            .attr('class', 'tooltip')\n            .style('opacity', 0);\n    }\n    /**\n     * Method to calculate vertical offset from the hidden \"fake\" root node\n     * @param descendants The hierarchy points\n     * @param circleSize The size of the circle\n     * @param fauxRootNode The name of the fake root node\n     */\n    calculateYOffset(descendants, circleSize, fauxRootNode) {\n        /**\n         * If we have already calculated the offset just return it.\n         * If not calculate the offset\n         */\n        if (typeof this.verticalOffset === 'undefined') {\n            const originalRoot = descendants.find((node) => Boolean(node.parent && node.parent.id === fauxRootNode));\n            /**\n             * Calculate the offset of the original root node,\n             * since the first faux root node that we added,\n             * we hide it and create an empty space to the top.\n             */\n            const yOffset = originalRoot ? originalRoot.y : 0;\n            this.verticalOffset = circleSize - yOffset / 2;\n        }\n        return this.verticalOffset;\n    }\n    getRootNodes(nodes, edges) {\n        const hasNoParent = (node) => edges.every(([, parent]) => node !== parent);\n        return nodes.filter(hasNoParent);\n    }\n    /**\n     * Calculate the size of the nodes in the graph depending on the number of nodes\n     * As the number of nodes in the tree gets bigger and bigger, the tree is becoming\n     * squeezed and the size of the nodes have to get smaller in order not to overlap\n     * witch each other.\n     * @param numberOfNodes Number of the nodes in the tree\n     */\n    getNodeSize(numberOfNodes) {\n        const howManyTens = Math.floor(numberOfNodes / 10);\n        /**\n         * Don't let node size go bellow 5\n         */\n        return Math.max(320 / (20 + howManyTens), 5);\n    }\n    async createDag() {\n        const { nodes, edges, node_details, positions } = this.data;\n        const bounds = this.calculateBounds(positions);\n        const maxHeight = bounds[1];\n        /**\n         * During initialization the wrapper elemete (this.el) has no width,\n         * we wait for that before we do any DOM calculations.\n         */\n        if (!this.initialized) {\n            await poll_1.poll(() => this.el.offsetWidth > 0, 300);\n        }\n        const numberOfNodes = nodes.length;\n        const lessThanThirtyNodes = numberOfNodes < 30;\n        const [scaleX, scaleY] = this.getScale();\n        /**\n         * Sometimes during updates we are getting different/weird positions object\n         * So we save and re-use the first positions object we are getting\n         */\n        this.positions = this.positions || positions;\n        if (!this.initialized) {\n            this.zoom();\n        }\n        const circleSize = this.getNodeSize(numberOfNodes);\n        const links = edges.map(([parent, child]) => ({\n            source: parent,\n            target: child\n        }));\n        const nodeDetails = Object.keys(node_details).map((node, i) => ({\n            index: i,\n            status: node_details[node].status,\n            id: node,\n            fx: this.positions[node][0] * scaleX,\n            /** For Y position we flip tree upside down (that's why: maxHeight - node's Y position) */\n            fy: (maxHeight - this.positions[node][1]) * scaleY\n        }));\n        const worker = new Worker(worker_js_1.default);\n        worker.postMessage({\n            nodes: nodeDetails,\n            links\n        });\n        worker.onmessage = event => {\n            if (event.data.type !== 'end') {\n                return;\n            }\n            /**\n             * Remove previous contents\n             */\n            this.wrapper.selectAll('*').remove();\n            const { nodes, links } = event.data;\n            this.wrapper\n                .append('g')\n                .selectAll('path')\n                .data(links)\n                .enter()\n                .append('path')\n                .attr('d', (d) => {\n                return `M${d.source.x},${d.source.y} C ${d.source.x},${(d.source.y + d.target.y) / 2} ${d.target.x},${(d.source.y + d.target.y) / 2} ${d.target.x},${d.target.y}`;\n            })\n                .attr('class', (d) => `path-${d.target.status}`);\n            this.wrapper\n                .append('g')\n                .selectAll('circle')\n                .data(nodes)\n                .enter()\n                .append('circle')\n                .attr('cx', (d) => d.x)\n                .attr('cy', (d) => d.y)\n                .attr('r', circleSize)\n                .attr('class', (d) => `${d.status} ${lessThanThirtyNodes ? 'node--small' : ''}`)\n                .on('mouseover', (d) => {\n                this.tooltip.transition().duration(200).style('opacity', 0.9);\n                this.tooltip\n                    .html(`<p>${d.id}: ${d.status}</p>`)\n                    .style('left', `${d3.event.clientX + 10}px`)\n                    .style('top', `${d3.event.clientY + 10}px`);\n            })\n                .on('mouseout', () => {\n                this.tooltip.transition().duration(500).style('opacity', 0);\n            });\n        };\n    }\n    createControls() {\n        const zoomInButton = document.createElement('button');\n        const zoomOutButton = document.createElement('button');\n        const resetButton = document.createElement('button');\n        const className = 'zoomControl';\n        zoomInButton.id = 'zoom_in';\n        zoomOutButton.id = 'zoom_out';\n        resetButton.className = 'resetControl';\n        zoomInButton.className = className;\n        zoomOutButton.className = className;\n        this.el.append(zoomInButton);\n        this.el.append(zoomOutButton);\n        this.el.append(resetButton);\n    }\n}\nexports.DagVisualizeView = DagVisualizeView;\n","export default __webpack_public_path__ + \"26c84ee286c89bc80d97e80b116a919ad0fd7135e61033ff9d953b42540a2aab.js\";"],"names":[],"sourceRoot":""}